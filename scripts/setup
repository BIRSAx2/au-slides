#!/bin/sh

case "$(uname)" in
    Linux*)  DATA_DIR="${XDG_DATA_HOME:-$HOME/.local/share}" ;;
    Darwin*) DATA_DIR="$HOME/Library/Application Support" ;;
    *)       DATA_DIR="$APPDATA" ;;
esac

read_toml() {
    sed -n "s/^$2[[:space:]]*=[[:space:]]*\"\(.*\)\"/\1/p" "$1"
}

SCRIPT_DIR=$(cd "$(dirname "$0")" && pwd)
ROOT=$(cd "$SCRIPT_DIR/.." && pwd)

PKG_NAME=$(read_toml "$ROOT/typst.toml" "name")
PKG_VERSION=$(read_toml "$ROOT/typst.toml" "version")

resolve_target() {
    case "$1" in
        "@local")   echo "${DATA_DIR}/typst/packages/local" ;;
        "@preview") echo "${DATA_DIR}/typst/packages/preview" ;;
        *)          echo "$1" ;;
    esac
}
